pipeline {
	parameters {
		gitParameter branchFilter: 'origin/(.*)', defaultValue: 'dev', name: 'BRANCH', type: 'PT_BRANCH'
	}
	agent {
		docker {
			image "writio/maven:latest"
			args "-v ${MAVEN_REPO_LOCAL}:/root/.m2/repository"
		}
	}
	stages {
		stage('git-checkout') {
			steps {
				echo "checking out git branch '${params.BRANCH}'..."
				git branch: "${params.BRANCH}", changelog: false, poll: false, url: 'https://github.com/cbehrenberg/writio.git'
			}
		}
		stage('mvn-clean-package') {
			steps {
				sh "mvn help:evaluate -Dexpression=settings.localRepository"
				sh "mvn clean package"
			}
		}
		stage('mvn-install') {
			steps {
				sh 'mvn install'
			}
		}
	}
}