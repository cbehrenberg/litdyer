# Writio MVP Datamodel Design

## Datamodel Design Decisions

- Currently a NoSQL schema is targetted.
- The design is intended for MongoDB usage.
- Since MongoDB is assumed, GridFS is currently targetted for ebook file storage (as it cannot be controlled how big the files are). This can change later.

## Datamodel Data Design

### High Level

- Database stores books and their metadata.
- Each book is based on an input ebook file.
- Each book file is used to extract a corpus, which is seperately stored as unpaginated text.
- Extraction of the book contents is tracked seperately and an asynchronous process.

### Low Level

- A book is the main data object, it is generated by parsing an ebook file:
  - The following meta data is stored: title, author, language.
  - The book cover is stored as image and a thumbnail.
- The book file is separately stored:
  - Since the file can be arbitrarily large, the file is stored in chunks.
  - The file is referenced in the book document.
- The text of the book text corpus is separately stored from the book:
  - It stores the book content as unpaginated text by enumerated chapters.
  - Each chapters contains a title and a number of sections.
  - Each section is composed by a number of paragraphs, which are arrays of strings.
- After uploading the file, the book is processed. This is separately tracked in a processing document.
  - Each processing document refers to one book.
  - It references the state for a book, for: metadata extraction, cover extraction and text extraction.
  - For each task, it is declared if the process has been started and finished.
  - If there is an error, the error message field is filled.

## Datamodel Data Runtime

- A book is created by injecting a file, hence the file is persisted first.
- The corpus and the book's metadata are retrieved by parsing the book file. This is done in the background. Hence, the correlated data might be added / set at a later point in time in no determined order.
- The thumbnail is derived from the cover image.

## Diagram

![writio_mvp_datamodel](./writio_mvp_datamodel.png)